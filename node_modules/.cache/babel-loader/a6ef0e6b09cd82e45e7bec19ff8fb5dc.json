{"ast":null,"code":"import _defineProperty from \"/Users/bilraj/Desktop/frontend_workshop-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/Users/bilraj/Desktop/frontend_workshop-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"/Users/bilraj/Desktop/frontend_workshop-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/Users/bilraj/Desktop/frontend_workshop-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/Users/bilraj/Desktop/frontend_workshop-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { useEffect, useReducer } from 'react';\nimport { APEX, Level2, Trade } from 'apex-api';\nimport { initialState, reducer } from './reducer';\nvar apex = new APEX('wss://api_demo.alphapoint.com/WSGateway/');\nexport var init =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(dispatch) {\n    var instruments, _instruments, instrument, products, SessionToken;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return apex.GetInstruments({\n              OMSId: 1\n            });\n\n          case 2:\n            instruments = _context.sent;\n            dispatch({\n              type: 'SET_INSTRUMENTS',\n              payload: instruments\n            });\n            _instruments = _slicedToArray(instruments, 1), instrument = _instruments[0];\n            dispatch({\n              type: 'SET_SELECTED_INSTRUMENT',\n              payload: instrument\n            });\n            _context.next = 8;\n            return apex.GetProducts({\n              OMSId: 1\n            });\n\n          case 8:\n            products = _context.sent;\n            dispatch({\n              type: 'SET_PRODUCTS',\n              payload: products\n            });\n            SessionToken = localStorage.getItem('TestSessionToken');\n\n            if (SessionToken) {\n              login({\n                SessionToken: SessionToken\n              }, dispatch);\n            }\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function init(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var login =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(creds, dispatch) {\n    var _ref3, Authenticated, SessionToken, user;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return apex.WebAuthenticateUser(creds);\n\n          case 2:\n            _ref3 = _context2.sent;\n            Authenticated = _ref3.Authenticated;\n            SessionToken = _ref3.SessionToken;\n\n            if (!Authenticated) {\n              _context2.next = 14;\n              break;\n            }\n\n            localStorage.setItem('TestSessionToken', SessionToken);\n            _context2.next = 9;\n            return apex.GetUserInfo();\n\n          case 9:\n            user = _context2.sent;\n            dispatch({\n              type: 'SET_USER',\n              payload: user\n            });\n            dispatch({\n              type: 'SET_LOGGED_IN',\n              payload: true\n            });\n            _context2.next = 16;\n            break;\n\n          case 14:\n            localStorage.removeItem('TestSessionToken');\n            dispatch({\n              type: 'SET_LOGGED_IN',\n              payload: false\n            });\n\n          case 16:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function login(_x2, _x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var logout = function logout(dispatch) {\n  dispatch({\n    type: 'SET_LOGGED_IN',\n    payload: false\n  });\n  apex.LogOut();\n};\nexport var useSubscribeLevel2 = function useSubscribeLevel2(_ref4, dispatch) {\n  var Depth = _ref4.Depth,\n      InstrumentId = _ref4.InstrumentId;\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var level2_response, data;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              dispatch({\n                type: 'CLEAR_ORDERBOOK'\n              });\n              _context3.next = 3;\n              return apex.SubscribeLevel2({\n                Depth: Depth,\n                InstrumentId: InstrumentId,\n                OMSId: 1\n              });\n\n            case 3:\n              level2_response = _context3.sent;\n              data = level2_response.map(function (x) {\n                return new Level2(x);\n              });\n              data.forEach(function (x) {\n                return x.Side === 0 ? dispatch({\n                  type: 'ADD_BUY',\n                  payload: x\n                }) : dispatch({\n                  type: 'ADD_SELL',\n                  payload: x\n                });\n              });\n              apex.level2.subscribe(function (l2) {\n                l2.forEach(function (x) {\n                  return x.Side === 0 ? dispatch({\n                    type: 'ADD_BUY',\n                    payload: x\n                  }) : dispatch({\n                    type: 'ADD_SELL',\n                    payload: x\n                  });\n                });\n              });\n\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }))();\n\n    return function () {\n      return apex.UnsubscribeLevel2({\n        InstrumentId: InstrumentId,\n        OMSId: 1\n      });\n    };\n  }, [InstrumentId]);\n};\nexport var useSubscribeLevel1 = function useSubscribeLevel1(InstrumentId, dispatch) {\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee4() {\n      var level1;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return apex.SubscribeLevel1({\n                OMSId: 1,\n                InstrumentId: InstrumentId\n              });\n\n            case 3:\n              level1 = _context4.sent;\n              dispatch({\n                type: 'SET_LEVEL_1',\n                payload: level1\n              });\n              apex.level1.subscribe(function (update) {\n                dispatch({\n                  type: 'SET_LEVEL_1',\n                  payload: update\n                });\n              });\n              _context4.next = 11;\n              break;\n\n            case 8:\n              _context4.prev = 8;\n              _context4.t0 = _context4[\"catch\"](0);\n              console.log(_context4.t0);\n\n            case 11:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 8]]);\n    }))();\n\n    return function () {\n      return apex.UnSubscribeLevel1({\n        OMSId: 1,\n        InstrumentId: InstrumentId\n      });\n    };\n  }, [InstrumentId]);\n};\nexport var useTrades = function useTrades(InstrumentId, tradesSub, dispatch) {\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee5() {\n      var trades_response, trades;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              if (tradesSub) {\n                _context5.next = 15;\n                break;\n              }\n\n              _context5.prev = 1;\n              dispatch({\n                type: 'SUBSCRIBED_TO_TRADES'\n              });\n              dispatch({\n                type: 'CLEAR_TRADES'\n              });\n              _context5.next = 6;\n              return apex.SubscribeTrades({\n                InstrumentId: InstrumentId,\n                OMSId: 1,\n                IncludeLastCount: 10\n              });\n\n            case 6:\n              trades_response = _context5.sent;\n              trades = trades_response.map(function (x) {\n                return new Trade(x);\n              });\n              trades.forEach(function (trade) {\n                return dispatch({\n                  type: 'ADD_TRADE',\n                  payload: trade\n                });\n              });\n              apex.trades.subscribe(function (trade) {\n                return dispatch({\n                  type: 'ADD_TRADE',\n                  payload: trade\n                });\n              });\n              _context5.next = 15;\n              break;\n\n            case 12:\n              _context5.prev = 12;\n              _context5.t0 = _context5[\"catch\"](1);\n              console.log(_context5.t0);\n\n            case 15:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[1, 12]]);\n    }))();\n\n    return function () {\n      return apex.UnSubscribeTrades({\n        InstrumentId: InstrumentId,\n        OMSId: 1\n      });\n    };\n  }, [InstrumentId]);\n};\nexport var useBalances = function useBalances(AccountId, loggedIn, dispatch) {\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee6() {\n      var positions_response;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              if (!loggedIn) {\n                _context6.next = 7;\n                break;\n              }\n\n              _context6.next = 3;\n              return apex.GetAccountPositions({\n                OMSId: 1,\n                AccountId: AccountId\n              });\n\n            case 3:\n              positions_response = _context6.sent;\n              dispatch({\n                type: 'ADD_BALANCES',\n                payload: positions_response\n              });\n              apex.SubscribeAccountEvents({\n                AccountId: AccountId,\n                OMSId: 1\n              });\n              apex.ws.filter(function (x) {\n                return x.n === 'AccountPositionEvent';\n              }).subscribe(function (response) {\n                var update = JSON.parse(response.o);\n                dispatch({\n                  type: 'UPDATE_BALANCE',\n                  payload: update\n                });\n              });\n\n            case 7:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }))();\n  }, [AccountId, loggedIn]);\n};\nexport var useOrders = function useOrders(AccountId, loggedIn, dispatch) {\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee7() {\n      var orders_response;\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              if (!loggedIn) {\n                _context7.next = 7;\n                break;\n              }\n\n              _context7.next = 3;\n              return apex.GetOpenOrders({\n                OMSId: 1,\n                AccountId: AccountId\n              });\n\n            case 3:\n              orders_response = _context7.sent;\n              dispatch({\n                type: 'ADD_ORDERS',\n                payload: orders_response\n              });\n              apex.SubscribeAccountEvents({\n                AccountId: AccountId,\n                OMSId: 1\n              });\n              apex.ws.filter(function (x) {\n                return x.n === 'OrderStateEvent';\n              }).subscribe(function (response) {\n                var update = JSON.parse(response.o);\n                dispatch({\n                  type: 'UPDATE_ORDERS',\n                  payload: update\n                });\n              });\n\n            case 7:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7);\n    }))();\n  }, [AccountId, loggedIn]);\n};\nexport var useAPEXReducer = function useAPEXReducer() {\n  var _useReducer = useReducer(reducer, initialState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  return [state, dispatch];\n};\nexport var sendOrder =\n/*#__PURE__*/\nfunction () {\n  var _ref10 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee8(order) {\n    var result;\n    return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            console.log(order);\n            _context8.next = 3;\n            return apex.SendOrder(order);\n\n          case 3:\n            result = _context8.sent;\n            console.log(result);\n\n          case 5:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, _callee8);\n  }));\n\n  return function sendOrder(_x4) {\n    return _ref10.apply(this, arguments);\n  };\n}();\nexport var cancelOrder =\n/*#__PURE__*/\nfunction () {\n  var _ref11 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee9(OrderId) {\n    var result;\n    return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n      while (1) {\n        switch (_context9.prev = _context9.next) {\n          case 0:\n            console.log(OrderId);\n            _context9.next = 3;\n            return apex.CancelOrder({\n              OMSId: 1,\n              OrderId: OrderId\n            });\n\n          case 3:\n            result = _context9.sent;\n            console.log(result);\n\n          case 5:\n          case \"end\":\n            return _context9.stop();\n        }\n      }\n    }, _callee9);\n  }));\n\n  return function cancelOrder(_x5) {\n    return _ref11.apply(this, arguments);\n  };\n}();\nexport var getDepositRequestInfoTemplate =\n/*#__PURE__*/\nfunction () {\n  var _ref12 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee10(params) {\n    var result, UseGetDepositWorkflow, _result, depositInfo;\n\n    return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n      while (1) {\n        switch (_context10.prev = _context10.next) {\n          case 0:\n            console.log(params);\n            _context10.prev = 1;\n            _context10.next = 4;\n            return apex.GetDepositRequestInfoTemplate(_objectSpread({\n              OMSId: 1\n            }, params));\n\n          case 4:\n            result = _context10.sent;\n            UseGetDepositWorkflow = result.Template.UseGetDepositWorkflow;\n\n            if (!UseGetDepositWorkflow) {\n              _context10.next = 16;\n              break;\n            }\n\n            console.log('CRYPTO');\n            _context10.next = 10;\n            return apex.GetDepositInfo(_objectSpread({\n              GenerateNewKey: true,\n              OMSId: 1\n            }, params));\n\n          case 10:\n            _result = _context10.sent;\n            depositInfo = JSON.parse(_result.DepositInfo).pop();\n            console.log(depositInfo);\n            return _context10.abrupt(\"return\", depositInfo);\n\n          case 16:\n            console.log('FIAT');\n            return _context10.abrupt(\"return\", false);\n\n          case 18:\n            _context10.next = 23;\n            break;\n\n          case 20:\n            _context10.prev = 20;\n            _context10.t0 = _context10[\"catch\"](1);\n            console.log(_context10.t0);\n\n          case 23:\n          case \"end\":\n            return _context10.stop();\n        }\n      }\n    }, _callee10, null, [[1, 20]]);\n  }));\n\n  return function getDepositRequestInfoTemplate(_x6) {\n    return _ref12.apply(this, arguments);\n  };\n}();\n/* \n{\"OMSId\":1,\"OperatorId\":1,\"AccountId\":83,\"RequestUser\":83,\"AssetId\":3,\"Amount\":1,\"DepositInfo\":\"{\\\"ProductSymbol\\\":\\\"USD\\\",\\\"fullname\\\":\\\"Josh\\\",\\\"comments\\\":\\\"TEST\\\"}\",\"Status\":\"New\"}\n*/\n\nexport var createDepositTicket =\n/*#__PURE__*/\nfunction () {\n  var _ref13 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee11(params) {\n    var Amount, AssetId, ProductSymbol, fullname, comments, AccountId, request, result;\n    return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n      while (1) {\n        switch (_context11.prev = _context11.next) {\n          case 0:\n            console.log(params);\n            Amount = params.Amount, AssetId = params.AssetId, ProductSymbol = params.ProductSymbol, fullname = params.fullname, comments = params.comments, AccountId = params.AccountId;\n            request = {\n              AccountId: AccountId,\n              OMSId: 1,\n              OperatorId: 1,\n              Amount: +Amount,\n              AssetId: +AssetId,\n              Status: 'New',\n              DepositInfo: JSON.stringify({\n                ProductSymbol: ProductSymbol,\n                fullname: fullname,\n                comments: comments\n              })\n            };\n            console.log(request);\n            _context11.next = 6;\n            return apex.CreateDepositTicket(request);\n\n          case 6:\n            result = _context11.sent;\n            console.log(result);\n\n          case 8:\n          case \"end\":\n            return _context11.stop();\n        }\n      }\n    }, _callee11);\n  }));\n\n  return function createDepositTicket(_x7) {\n    return _ref13.apply(this, arguments);\n  };\n}();\nexport var getWithdrawTemplateTypes = function getWithdrawTemplateTypes(params) {};\nexport var getWithdrawInfo =\n/*#__PURE__*/\nfunction () {\n  var _ref15 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee12(_ref14) {\n    var ProductId, result, TemplateTypes, _TemplateTypes, TemplateType, template, Template;\n\n    return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n      while (1) {\n        switch (_context12.prev = _context12.next) {\n          case 0:\n            ProductId = _ref14.ProductId;\n            _context12.next = 3;\n            return apex.GetWithdrawTemplateTypes({\n              OMSId: 1,\n              ProductId: ProductId\n            });\n\n          case 3:\n            result = _context12.sent;\n            console.log(result);\n            TemplateTypes = result.TemplateTypes;\n            _TemplateTypes = _slicedToArray(TemplateTypes, 1), TemplateType = _TemplateTypes[0];\n            console.log(TemplateType);\n            _context12.next = 10;\n            return apex.GetWithdrawTemplate({\n              OMSId: 1,\n              ProductId: ProductId,\n              TemplateType: TemplateType\n            });\n\n          case 10:\n            template = _context12.sent;\n            Template = template.Template;\n            return _context12.abrupt(\"return\", JSON.parse(Template));\n\n          case 13:\n          case \"end\":\n            return _context12.stop();\n        }\n      }\n    }, _callee12);\n  }));\n\n  return function getWithdrawInfo(_x8) {\n    return _ref15.apply(this, arguments);\n  };\n}();\n/* \n{\"OMSId\":1,\"AccountId\":83,\"ProductId\":3,\"Amount\":1,\"TemplateForm\":\"{ \\\"FullName\\\":\\\"Joshua Rossi\\\",\\\"BankAddress\\\":\\\"410 E 65th St, Apt 2F\\\",\\\"Language\\\":\\\"EN\\\",\\\"Comment\\\":\\\"TEST\\\",\\\"BankAccountNumber\\\":\\\"1\\\",\\\"BankAccountName\\\":\\\"b\\\",\\\"SwiftCode\\\":\\\"1\\\",\\\"Amount\\\":1}\", \"TemplateType\": \"Standard\" }\n*/\n\nexport var getFromLS = function getFromLS(key) {\n  var ls = {};\n\n  if (global.localStorage) {\n    try {\n      ls = JSON.parse(global.localStorage.getItem('rgl-7')) || {};\n    } catch (e) {\n      /*Ignore*/\n    }\n  }\n\n  return ls[key];\n};\nexport var saveToLS = function saveToLS(key, value) {\n  if (global.localStorage) {\n    global.localStorage.setItem('rgl-7', JSON.stringify(_defineProperty({}, key, value)));\n  }\n};","map":{"version":3,"sources":["/Users/bilraj/Desktop/frontend_workshop-master/src/api.js"],"names":["useEffect","useReducer","APEX","Level2","Trade","initialState","reducer","apex","init","dispatch","GetInstruments","OMSId","instruments","type","payload","instrument","GetProducts","products","SessionToken","localStorage","getItem","login","creds","WebAuthenticateUser","Authenticated","setItem","GetUserInfo","user","removeItem","logout","LogOut","useSubscribeLevel2","Depth","InstrumentId","SubscribeLevel2","level2_response","data","map","x","forEach","Side","level2","subscribe","l2","UnsubscribeLevel2","useSubscribeLevel1","SubscribeLevel1","level1","update","console","log","UnSubscribeLevel1","useTrades","tradesSub","SubscribeTrades","IncludeLastCount","trades_response","trades","trade","UnSubscribeTrades","useBalances","AccountId","loggedIn","GetAccountPositions","positions_response","SubscribeAccountEvents","ws","filter","n","response","JSON","parse","o","useOrders","GetOpenOrders","orders_response","useAPEXReducer","state","sendOrder","order","SendOrder","result","cancelOrder","OrderId","CancelOrder","getDepositRequestInfoTemplate","params","GetDepositRequestInfoTemplate","UseGetDepositWorkflow","Template","GetDepositInfo","GenerateNewKey","depositInfo","DepositInfo","pop","createDepositTicket","Amount","AssetId","ProductSymbol","fullname","comments","request","OperatorId","Status","stringify","CreateDepositTicket","getWithdrawTemplateTypes","getWithdrawInfo","ProductId","GetWithdrawTemplateTypes","TemplateTypes","TemplateType","GetWithdrawTemplate","template","getFromLS","key","ls","global","e","saveToLS","value"],"mappings":"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","sourcesContent":["import { useEffect, useReducer } from 'react';\nimport { APEX, Level2, Trade } from 'apex-api';\nimport { initialState, reducer } from './reducer';\n\nconst apex = new APEX('wss://api_demo.alphapoint.com/WSGateway/');\n\nexport const init = async dispatch => {\n  const instruments = await apex.GetInstruments({ OMSId: 1 });\n  dispatch({ type: 'SET_INSTRUMENTS', payload: instruments });\n  const [instrument] = instruments;\n  dispatch({ type: 'SET_SELECTED_INSTRUMENT', payload: instrument });\n  const products = await apex.GetProducts({ OMSId: 1 });\n  dispatch({ type: 'SET_PRODUCTS', payload: products });\n  const SessionToken = localStorage.getItem('TestSessionToken');\n  if (SessionToken) {\n    login({ SessionToken }, dispatch);\n  }\n};\n\nexport const login = async (creds, dispatch) => {\n  const { Authenticated, SessionToken } = await apex.WebAuthenticateUser(creds);\n  if (Authenticated) {\n    localStorage.setItem('TestSessionToken', SessionToken);\n    const user = await apex.GetUserInfo();\n    dispatch({ type: 'SET_USER', payload: user });\n    dispatch({ type: 'SET_LOGGED_IN', payload: true });\n  } else {\n    localStorage.removeItem('TestSessionToken');\n    dispatch({ type: 'SET_LOGGED_IN', payload: false });\n  }\n};\n\nexport const logout = dispatch => {\n  dispatch({ type: 'SET_LOGGED_IN', payload: false });\n  apex.LogOut();\n};\n\nexport const useSubscribeLevel2 = ({ Depth, InstrumentId }, dispatch) => {\n  useEffect(() => {\n    (async () => {\n      dispatch({ type: 'CLEAR_ORDERBOOK' });\n      const level2_response = await apex.SubscribeLevel2({\n        Depth,\n        InstrumentId,\n        OMSId: 1\n      });\n      const data = level2_response.map(x => new Level2(x));\n      data.forEach(x =>\n        x.Side === 0\n          ? dispatch({ type: 'ADD_BUY', payload: x })\n          : dispatch({ type: 'ADD_SELL', payload: x })\n      );\n      apex.level2.subscribe(l2 => {\n        l2.forEach(x =>\n          x.Side === 0\n            ? dispatch({ type: 'ADD_BUY', payload: x })\n            : dispatch({ type: 'ADD_SELL', payload: x })\n        );\n      });\n    })();\n    return () => apex.UnsubscribeLevel2({ InstrumentId, OMSId: 1 });\n  }, [InstrumentId]);\n};\n\nexport const useSubscribeLevel1 = (InstrumentId, dispatch) => {\n  useEffect(() => {\n    (async () => {\n      try {\n        const level1 = await apex.SubscribeLevel1({\n          OMSId: 1,\n          InstrumentId\n        });\n        dispatch({ type: 'SET_LEVEL_1', payload: level1 });\n        apex.level1.subscribe(update => {\n          dispatch({ type: 'SET_LEVEL_1', payload: update });\n        });\n      } catch (e) {\n        console.log(e);\n      }\n    })();\n    return () => apex.UnSubscribeLevel1({ OMSId: 1, InstrumentId });\n  }, [InstrumentId]);\n};\n\nexport const useTrades = (InstrumentId, tradesSub, dispatch) => {\n  useEffect(() => {\n    (async () => {\n      if (!tradesSub) {\n        try {\n          dispatch({ type: 'SUBSCRIBED_TO_TRADES' });\n          dispatch({ type: 'CLEAR_TRADES' });\n          const trades_response = await apex.SubscribeTrades({\n            InstrumentId,\n            OMSId: 1,\n            IncludeLastCount: 10\n          });\n          const trades = trades_response.map(x => new Trade(x));\n          trades.forEach(trade =>\n            dispatch({ type: 'ADD_TRADE', payload: trade })\n          );\n          apex.trades.subscribe(trade =>\n            dispatch({ type: 'ADD_TRADE', payload: trade })\n          );\n        } catch (e) {\n          console.log(e);\n        }\n      }\n    })();\n    return () => apex.UnSubscribeTrades({ InstrumentId, OMSId: 1 });\n  }, [InstrumentId]);\n};\n\nexport const useBalances = (AccountId, loggedIn, dispatch) => {\n  useEffect(() => {\n    (async () => {\n      if (loggedIn) {\n        const positions_response = await apex.GetAccountPositions({\n          OMSId: 1,\n          AccountId\n        });\n        dispatch({ type: 'ADD_BALANCES', payload: positions_response });\n        apex.SubscribeAccountEvents({\n          AccountId,\n          OMSId: 1\n        });\n        apex.ws\n          .filter(x => x.n === 'AccountPositionEvent')\n          .subscribe(response => {\n            const update = JSON.parse(response.o);\n            dispatch({ type: 'UPDATE_BALANCE', payload: update });\n          });\n      }\n    })();\n  }, [AccountId, loggedIn]);\n};\n\nexport const useOrders = (AccountId, loggedIn, dispatch) => {\n  useEffect(() => {\n    (async () => {\n      if (loggedIn) {\n        const orders_response = await apex.GetOpenOrders({\n          OMSId: 1,\n          AccountId\n        });\n        dispatch({ type: 'ADD_ORDERS', payload: orders_response });\n        apex.SubscribeAccountEvents({\n          AccountId,\n          OMSId: 1\n        });\n        apex.ws\n          .filter(x => x.n === 'OrderStateEvent')\n          .subscribe(response => {\n            const update = JSON.parse(response.o);\n            dispatch({ type: 'UPDATE_ORDERS', payload: update });\n          });\n      }\n    })();\n  }, [AccountId, loggedIn]);\n};\n\nexport const useAPEXReducer = () => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n  return [state, dispatch];\n};\n\nexport const sendOrder = async order => {\n  console.log(order);\n  const result = await apex.SendOrder(order);\n  console.log(result);\n};\n\nexport const cancelOrder = async OrderId => {\n  console.log(OrderId);\n  const result = await apex.CancelOrder({ OMSId: 1, OrderId });\n  console.log(result);\n};\n\nexport const getDepositRequestInfoTemplate = async params => {\n  console.log(params);\n  try {\n    const result = await apex.GetDepositRequestInfoTemplate({\n      OMSId: 1,\n      ...params\n    });\n    const {\n      Template: { UseGetDepositWorkflow }\n    } = result;\n    if (UseGetDepositWorkflow) {\n      console.log('CRYPTO');\n      const result = await apex.GetDepositInfo({\n        GenerateNewKey: true,\n        OMSId: 1,\n        ...params\n      });\n      const depositInfo = JSON.parse(result.DepositInfo).pop();\n      console.log(depositInfo);\n      return depositInfo;\n    } else {\n      console.log('FIAT');\n      return false;\n    }\n  } catch (e) {\n    console.log(e);\n  }\n};\n\n/* \n{\"OMSId\":1,\"OperatorId\":1,\"AccountId\":83,\"RequestUser\":83,\"AssetId\":3,\"Amount\":1,\"DepositInfo\":\"{\\\"ProductSymbol\\\":\\\"USD\\\",\\\"fullname\\\":\\\"Josh\\\",\\\"comments\\\":\\\"TEST\\\"}\",\"Status\":\"New\"}\n*/\nexport const createDepositTicket = async params => {\n  console.log(params);\n  const {\n    Amount,\n    AssetId,\n    ProductSymbol,\n    fullname,\n    comments,\n    AccountId\n  } = params;\n  const request = {\n    AccountId,\n    OMSId: 1,\n    OperatorId: 1,\n    Amount: +Amount,\n    AssetId: +AssetId,\n    Status: 'New',\n    DepositInfo: JSON.stringify({ ProductSymbol, fullname, comments })\n  };\n  console.log(request);\n  const result = await apex.CreateDepositTicket(request);\n  console.log(result);\n};\n\nexport const getWithdrawTemplateTypes = params => {};\n\nexport const getWithdrawInfo = async ({ ProductId }) => {\n  const result = await apex.GetWithdrawTemplateTypes({\n    OMSId: 1,\n    ProductId\n  });\n  console.log(result);\n  const { TemplateTypes } = result;\n  const [TemplateType] = TemplateTypes;\n  console.log(TemplateType);\n  const template = await apex.GetWithdrawTemplate({\n    OMSId: 1,\n    ProductId,\n    TemplateType\n  });\n  const { Template } = template;\n  return JSON.parse(Template);\n};\n\n/* \n{\"OMSId\":1,\"AccountId\":83,\"ProductId\":3,\"Amount\":1,\"TemplateForm\":\"{ \\\"FullName\\\":\\\"Joshua Rossi\\\",\\\"BankAddress\\\":\\\"410 E 65th St, Apt 2F\\\",\\\"Language\\\":\\\"EN\\\",\\\"Comment\\\":\\\"TEST\\\",\\\"BankAccountNumber\\\":\\\"1\\\",\\\"BankAccountName\\\":\\\"b\\\",\\\"SwiftCode\\\":\\\"1\\\",\\\"Amount\\\":1}\", \"TemplateType\": \"Standard\" }\n*/\n\nexport const getFromLS = key => {\n  let ls = {};\n  if (global.localStorage) {\n    try {\n      ls = JSON.parse(global.localStorage.getItem('rgl-7')) || {};\n    } catch (e) {\n      /*Ignore*/\n    }\n  }\n  return ls[key];\n};\n\nexport const saveToLS = (key, value) => {\n  if (global.localStorage) {\n    global.localStorage.setItem(\n      'rgl-7',\n      JSON.stringify({\n        [key]: value\n      })\n    );\n  }\n};\n"]},"metadata":{},"sourceType":"module"}